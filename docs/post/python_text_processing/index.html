<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Notes: Text processing and Regular expressions in Python - Nihaal</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Abdun Nihaal" /><meta name="description" content="In this post, we will learn by example, text processing and regular expression basics in Python. We will also learn how to use inbuilt and external packages, to take command line arguments and to read data from files.
Notes Execute python scripts like executable Normally, we can execute python scripts by running python script.py. If we want to execute python scripts like an executable on the terminal we can add the following line as the first line of the script." />






<meta name="generator" content="Hugo 0.126.1 with theme even" />


<link rel="canonical" href="https://nihaal.me/post/python_text_processing/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css" rel="stylesheet">
<link href="/lib/fancybox/jquery.fancybox-3.1.20.min.css" rel="stylesheet">


<meta property="og:url" content="https://nihaal.me/post/python_text_processing/">
  <meta property="og:site_name" content="Nihaal">
  <meta property="og:title" content="Notes: Text processing and Regular expressions in Python">
  <meta property="og:description" content="In this post, we will learn by example, text processing and regular expression basics in Python. We will also learn how to use inbuilt and external packages, to take command line arguments and to read data from files.
Notes Execute python scripts like executable Normally, we can execute python scripts by running python script.py. If we want to execute python scripts like an executable on the terminal we can add the following line as the first line of the script.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2024-10-24T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-10-24T00:00:00+00:00">
    <meta property="article:tag" content="Python">

  <meta itemprop="name" content="Notes: Text processing and Regular expressions in Python">
  <meta itemprop="description" content="In this post, we will learn by example, text processing and regular expression basics in Python. We will also learn how to use inbuilt and external packages, to take command line arguments and to read data from files.
Notes Execute python scripts like executable Normally, we can execute python scripts by running python script.py. If we want to execute python scripts like an executable on the terminal we can add the following line as the first line of the script.">
  <meta itemprop="datePublished" content="2024-10-24T00:00:00+00:00">
  <meta itemprop="dateModified" content="2024-10-24T00:00:00+00:00">
  <meta itemprop="wordCount" content="1665">
  <meta itemprop="keywords" content="Python">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Notes: Text processing and Regular expressions in Python">
  <meta name="twitter:description" content="In this post, we will learn by example, text processing and regular expression basics in Python. We will also learn how to use inbuilt and external packages, to take command line arguments and to read data from files.
Notes Execute python scripts like executable Normally, we can execute python scripts by running python script.py. If we want to execute python scripts like an executable on the terminal we can add the following line as the first line of the script.">

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

<script defer data-domain="nihaal.me" src="https://stats.nihaal.me/js/script.js"></script>
<script>
  (function(w, d, t, h, s, n) {
    w.FlodeskObject = n;
    var fn = function() {
      (w[n].q = w[n].q || []).push(arguments);
    };
    w[n] = w[n] || fn;
    var f = d.getElementsByTagName(t)[0];
    var v = '?v=' + Math.floor(new Date().getTime() / (120 * 1000)) * 60;
    var sm = d.createElement(t);
    sm.async = true;
    sm.type = 'module';
    sm.src = h + s + '.mjs' + v;
    f.parentNode.insertBefore(sm, f);
    var sn = d.createElement(t);
    sn.async = true;
    sn.noModule = true;
    sn.src = h + s + '.js' + v;
    f.parentNode.insertBefore(sn, f);
  })(window, document, 'script', 'https://assets.flodesk.com', '/universal', 'fd');
</script>

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Nihaal</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Nihaal</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Notes: Text processing and Regular expressions in Python</h1>

      <div class="post-meta">
        <span class="post-time"> 24-10-2024 </span>
        
          <span class="more-meta"> 1665 words </span>
          <span class="more-meta"> 8 mins read </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#notes">Notes</a>
          <ul>
            <li><a href="#execute-python-scripts-like-executable">Execute python scripts like executable</a></li>
            <li><a href="#two-ways-to-import-from-packages">Two ways to import from packages</a></li>
            <li><a href="#taking-inputs-via-command-line-arguments">Taking inputs via command line arguments</a></li>
            <li><a href="#file-handling">File handling</a></li>
            <li><a href="#basic-string-processing">Basic string processing</a></li>
            <li><a href="#regular-expression-basics">Regular expression basics</a></li>
            <li><a href="#regular-expression-in-python">Regular expression in Python</a></li>
            <li><a href="#using-external-packages-from-python-package-index-pypi">Using external packages from (Python Package Index) PyPI</a></li>
          </ul>
        </li>
        <li><a href="#script-to-extract-information-from-sudo-logs">Script to extract information from sudo logs</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>In this post, we will learn by example, text processing and regular expression basics in Python.
We will also learn how to use inbuilt and external packages, to take command line arguments and to read data from files.</p>
<h2 id="notes">Notes</h2>
<h3 id="execute-python-scripts-like-executable">Execute python scripts like executable</h3>
<p>Normally, we can execute python scripts by running <code>python script.py</code>. If we want to execute python scripts like an executable on the terminal we can add the following line as the first line of the script.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/env python3</span>
</span></span></code></pre></div><p>Add execute permissions on the script and now you can execute the script like an executable.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>chmod +x file.py
</span></span><span style="display:flex;"><span>./file.py
</span></span></code></pre></div><h3 id="two-ways-to-import-from-packages">Two ways to import from packages</h3>
<ol>
<li>
<p>Import the whole package and then use objects defined in it by using &lsquo;.&rsquo;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span>print(sys<span style="color:#f92672">.</span>argv)
</span></span></code></pre></div></li>
<li>
<p>Import objects and functions selectively from packages</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> sys <span style="color:#f92672">import</span> argv
</span></span><span style="display:flex;"><span>print (argv)
</span></span></code></pre></div></li>
</ol>
<h3 id="taking-inputs-via-command-line-arguments">Taking inputs via command line arguments</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> sys <span style="color:#f92672">import</span> argv
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Check argument count</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (len(argv) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">2</span>):
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;Usage: &#34;</span> <span style="color:#f92672">+</span> argv[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; &lt;logfile&gt;&#34;</span>)
</span></span><span style="display:flex;"><span>    exit()
</span></span><span style="display:flex;"><span>filename <span style="color:#f92672">=</span> argv[<span style="color:#ae81ff">1</span>]
</span></span></code></pre></div><h3 id="file-handling">File handling</h3>
<p>We can open a file using <code>open</code> and close them with <code>close</code> functions like shown below:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>f <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#34;filename&#34;</span>)
</span></span><span style="display:flex;"><span>f <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#34;filename&#34;</span>, <span style="color:#e6db74">&#34;a&#34;</span>) <span style="color:#75715e"># Optionally specify mode: r (read) w (write), a (append), x (create)</span>
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>read()
</span></span><span style="display:flex;"><span>f<span style="color:#f92672">.</span>close()
</span></span></code></pre></div><p>However the common way is to use a <code>with</code> statement which will automatically close a file when execution exits the block.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;filename&#34;</span>, <span style="color:#e6db74">&#34;r&#34;</span>) <span style="color:#66d9ef">as</span> infile:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># File processing</span>
</span></span><span style="display:flex;"><span>    infile<span style="color:#f92672">.</span>read()
</span></span><span style="display:flex;"><span>    infile<span style="color:#f92672">.</span>readline()
</span></span><span style="display:flex;"><span>    infile<span style="color:#f92672">.</span>readlines()
</span></span><span style="display:flex;"><span><span style="color:#75715e"># File is automatically closed at this point</span>
</span></span></code></pre></div><h3 id="basic-string-processing">Basic string processing</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>line <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Hello world, Hi&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Split a string into substrings delimited by the given character (here &#39;,&#39;)</span>
</span></span><span style="display:flex;"><span>line<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;,&#39;</span>)             <span style="color:#75715e"># [&#34;Hello world&#34;, &#34; Hi&#34;]</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Join the array elements with the given string as glue</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;-&#34;</span><span style="color:#f92672">.</span>join([<span style="color:#e6db74">&#39;a&#39;</span>, <span style="color:#e6db74">&#39;b&#39;</span>, <span style="color:#e6db74">&#39;c&#39;</span>])   <span style="color:#75715e"># &#34;a-b-c&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Check if a string starts with a prefix, or ends with a suffix</span>
</span></span><span style="display:flex;"><span>line<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">&#34;Hello&#34;</span>)    <span style="color:#75715e"># True</span>
</span></span><span style="display:flex;"><span>line<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">&#34;World&#34;</span>)    <span style="color:#75715e"># False</span>
</span></span><span style="display:flex;"><span>line<span style="color:#f92672">.</span>endswith(<span style="color:#e6db74">&#34;Hi&#34;</span>)         <span style="color:#75715e"># True</span>
</span></span><span style="display:flex;"><span>line<span style="color:#f92672">.</span>endswith(<span style="color:#e6db74">&#34;Hello&#34;</span>)      <span style="color:#75715e"># False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Convert string to lower or upper case</span>
</span></span><span style="display:flex;"><span>line<span style="color:#f92672">.</span>lower()
</span></span><span style="display:flex;"><span>line<span style="color:#f92672">.</span>upper()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Find the position of a substring in a string. Returns -1 if not found</span>
</span></span><span style="display:flex;"><span>line<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#34;world&#34;</span>)          <span style="color:#75715e"># 6</span>
</span></span><span style="display:flex;"><span>line<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#34;ABC&#34;</span>)            <span style="color:#75715e"># -1</span>
</span></span></code></pre></div><h3 id="regular-expression-basics">Regular expression basics</h3>
<ul>
<li>Language for describing string patterns
<ul>
<li>used in grep, sed, awk, &hellip;</li>
<li>used for find and replace, or searching</li>
</ul>
</li>
</ul>
<pre tabindex="0"><code>1. Specify characters to match
    a           matches character a
    [a-z]       matches lowercase alphabets
    [a-zA-Z0-9] matches alphabets and numbers
    [abc]       matches characters a b c
    [^abc]      matches anything except characters a b c

2. Specify count of characters to match
    *           Zero or more instances
    \+          One or more instances
    ?           Zero or one instances
    {8}         Matches 8 instances
    {1,3}       Matches 1 to 3 instances
    {3,}        Matches 3 or more instances

3. Special characters
    .           Matches any character
    ^           Matches the beginning of the line
    $           Matches the end of the line

4. Combining regex
    re1re2      Matches re1 first then re2 (Concatenation)
    re1|re2     Matches either re1 or re2 (Choice)

5. Backreferences
    Used for selecting a part of the matched string
    Enclose parts of the regex with ( .. ) parenthesis
    Can be referred as \1, \2, ... in re.sub
</code></pre><h3 id="regular-expression-in-python">Regular expression in Python</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> re
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Check for match only at beginning of string</span>
</span></span><span style="display:flex;"><span>m <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span><span style="color:#66d9ef">match</span>(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;pattern&#39;</span>, <span style="color:#e6db74">&#39;string to search&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Check for match anywhere in the string</span>
</span></span><span style="display:flex;"><span>m <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span>search(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;pattern&#39;</span>, <span style="color:#e6db74">&#39;string to search&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Both of these functions return a match object</span>
</span></span><span style="display:flex;"><span>print(m<span style="color:#f92672">.</span>group(<span style="color:#ae81ff">0</span>)) <span style="color:#75715e"># Gives the whole sequence that was matched</span>
</span></span><span style="display:flex;"><span>print(m<span style="color:#f92672">.</span>group(<span style="color:#ae81ff">1</span>)) <span style="color:#75715e"># Gives the first matches subgroup (regex enclosed in parenthesis) if any</span>
</span></span><span style="display:flex;"><span>print(m<span style="color:#f92672">.</span>groups()) <span style="color:#75715e"># Gives all matched subgroup (regex enclosed in parenthesis)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Finds all non overlapping matches</span>
</span></span><span style="display:flex;"><span>re<span style="color:#f92672">.</span>findall(<span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;pattern&#39;</span>, <span style="color:#e6db74">&#39;string to search&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Find and replace with regular expression</span>
</span></span><span style="display:flex;"><span>re<span style="color:#f92672">.</span>sub(pattern, replacement_pattern, string)
</span></span></code></pre></div><h3 id="using-external-packages-from-python-package-index-pypi">Using external packages from (Python Package Index) PyPI</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># Create and use a virtual environment (to avoid messing with global packages)</span>
</span></span><span style="display:flex;"><span>python -m venv env
</span></span><span style="display:flex;"><span>source env/bin/activate
</span></span><span style="display:flex;"><span>deactivate <span style="color:#75715e"># To come out of virtual environment</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Install package with pip (Run inside virtual environment)</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># pip will install the package from Python Package Index (PyPI) along with any dependencies</span>
</span></span><span style="display:flex;"><span>pip install &lt;packagename&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Inorder to run your script on some other system,</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># In your development virtual environment, record python dependencies in a file</span>
</span></span><span style="display:flex;"><span>pip freeze &gt; requirements.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># On new system, create a virtual environment</span>
</span></span><span style="display:flex;"><span>python3 -m venv newenv
</span></span><span style="display:flex;"><span>source newenv/bin/activate
</span></span><span style="display:flex;"><span>pip install -r requirements.txt <span style="color:#75715e"># Use the requirements.txt file to install all dependencies</span>
</span></span><span style="display:flex;"><span>python script.py
</span></span></code></pre></div><h2 id="script-to-extract-information-from-sudo-logs">Script to extract information from sudo logs</h2>
<p>A common usecase for writing a python script is to extract information we need from structured logs, and regular expressions are a powerful tool for doing that.
As an example, we will write a script that converts sudo logs into a format that is easier to view in a table format. Let&rsquo;s say, we are only interested in finding (1) which user executed (2) what command and (3) when it was executed. The sudo logs can be obtained by running <code>sudo journalctl _COMM=sudo &gt; logdata</code> on your terminal. The default format looks like below:</p>
<pre tabindex="0"><code>Aug 03 13:56:41 iserver sudo[2685498]:   xyzuser : TTY=pts/8 ; PWD=/home/xyzuser/ok ; USER=root ; COMMAND=/usr/bin/apt-get update
Aug 03 13:56:41 iserver sudo[2685498]: pam_unix(sudo:session): session opened for user root by xyzuser(uid=0)
Aug 03 13:56:44 iserver sudo[2685498]: pam_unix(sudo:session): session closed for user root
Aug 03 13:56:47 iserver sudo[2685979]:   xyzuser : TTY=pts/8 ; PWD=/home/xyzuser/ok ; USER=root ; COMMAND=/usr/bin/apt-get upgrade
Aug 03 13:56:47 iserver sudo[2685979]: pam_unix(sudo:session): session opened for user root by xyzuser(uid=0)
Aug 03 13:56:48 iserver sudo[2685979]: pam_unix(sudo:session): session closed for user root
Aug 03 13:57:02 iserver sudo[2686016]:   xyzuser : TTY=pts/8 ; PWD=/home/xyzuser/ok ; USER=root ; COMMAND=/usr/bin/apt-get upgrade -f
Aug 03 13:57:02 iserver sudo[2686016]: pam_unix(sudo:session): session opened for user root by xyzuser(uid=0)
Aug 03 13:57:03 iserver sudo[2686016]: pam_unix(sudo:session): session closed for user root
Aug 03 13:57:30 iserver sudo[2686075]:   xyzuser : TTY=pts/8 ; PWD=/home/xyzuser/ok ; USER=root ; COMMAND=/usr/bin/apt-get dist-upgrade
Aug 03 13:57:30 iserver sudo[2686075]: pam_unix(sudo:session): session opened for user root by xyzuser(uid=0)
Aug 03 13:57:52 iserver sudo[2686075]: pam_unix(sudo:session): session closed for user root
Aug 03 14:03:02 iserver sudo[2689098]:   xyzuser : TTY=pts/14 ; PWD=/home/xyzuser ; USER=root ; COMMAND=/usr/bin/apt-get install gawk bison gcc make wget tar -y
Aug 03 14:03:02 iserver sudo[2689098]: pam_unix(sudo:session): session opened for user root by xyzuser(uid=0)
Aug 03 14:03:03 iserver sudo[2689098]: pam_unix(sudo:session): session closed for user root
Aug 03 14:05:05 iserver sudo[2689399]:   xyzuser : TTY=pts/13 ; PWD=/home/xyzuser/ok ; USER=root ; COMMAND=/usr/bin/do-release-upgrade
Aug 03 14:05:05 iserver sudo[2689399]: pam_unix(sudo:session): session opened for user root by xyzuser(uid=0)
Aug 03 14:05:07 iserver sudo[2689399]: pam_unix(sudo:session): session closed for user root
Aug 03 14:07:29 iserver sudo[2689779]:   xyzuser : TTY=pts/0 ; PWD=/home/xyzuser ; USER=root ; COMMAND=/sbin/reboot now
Aug 03 14:07:29 iserver sudo[2689779]: pam_unix(sudo:session): session opened for user root by xyzuser(uid=0)
Aug 03 14:07:29 iserver sudo[2689779]: pam_unix(sudo:session): session closed for user root
</code></pre><p>The python script for extracting the information and printing on the terminal is shown below:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/env python3</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sys <span style="color:#f92672">import</span> argv
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> re
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># We check if the user specified the filename of the logs by checking if the length</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># of command line arguments is 2. Note that the first element of argv is the command used</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># to execute the script</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (len(argv) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">2</span>):
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;Incorrect number of arguments passed&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;Usage: &#34;</span> <span style="color:#f92672">+</span> argv[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; &lt;logfile&gt;&#34;</span>)
</span></span><span style="display:flex;"><span>    exit() <span style="color:#75715e"># If arguments is not as expected, exit</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Check if the filename exists in the filesystem using os.path.exists function</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>exists(argv[<span style="color:#ae81ff">1</span>]):
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;File doesn&#39;t exist&#34;</span>)
</span></span><span style="display:flex;"><span>    exit() <span style="color:#75715e"># If not, exit</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>filename <span style="color:#f92672">=</span> argv[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Regex pattern for the sudo logs where the subgroups are datetime, username and the command</span>
</span></span><span style="display:flex;"><span>matchpattern<span style="color:#f92672">=</span><span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;(^[a-zA-Z]+ [0-9]+ [0-9:]+)[^:]+:[ ]+([a-zA-Z0-9]+).*COMMAND=(.*)&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Read the file and process each line</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(filename, <span style="color:#e6db74">&#34;r&#34;</span>) <span style="color:#66d9ef">as</span> infile:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> infile<span style="color:#f92672">.</span>readlines():
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Check if &#34;COMMAND&#34; is present in the line, if not continue</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> line<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#34;COMMAND&#34;</span>) <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Match the regex pattern with the line</span>
</span></span><span style="display:flex;"><span>            m <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span><span style="color:#66d9ef">match</span>(matchpattern, line)
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Extract the subgroups</span>
</span></span><span style="display:flex;"><span>            date <span style="color:#f92672">=</span> m<span style="color:#f92672">.</span>group(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>            name <span style="color:#f92672">=</span> m<span style="color:#f92672">.</span>group(<span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>            command <span style="color:#f92672">=</span> m<span style="color:#f92672">.</span>group(<span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Print them in the required format</span>
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>date<span style="color:#e6db74">}</span><span style="color:#e6db74"> : </span><span style="color:#e6db74">{</span>name<span style="color:#e6db74">}</span><span style="color:#e6db74"> : </span><span style="color:#e6db74">{</span>command<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span></code></pre></div><p>The output from the above script looks like:</p>
<pre tabindex="0"><code>Aug 03 13:56:41 : xyzuser : /usr/bin/apt-get update
Aug 03 13:56:47 : xyzuser : /usr/bin/apt-get upgrade
Aug 03 13:57:02 : xyzuser : /usr/bin/apt-get upgrade -f
Aug 03 13:57:30 : xyzuser : /usr/bin/apt-get dist-upgrade
Aug 03 14:03:02 : xyzuser : /usr/bin/apt-get install gawk bison gcc make wget tar -y
Aug 03 14:05:05 : xyzuser : /usr/bin/do-release-upgrade
Aug 03 14:07:29 : xyzuser : /sbin/reboot now
</code></pre><p>Now we will use a python package called prettytable to print this information as a table. Make sure to install prettytable package using pip.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/env python3</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> sys <span style="color:#f92672">import</span> argv
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> re
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># We import colortable from the prettytable package, create an instance of PrettyTable object</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> prettytable.colortable <span style="color:#f92672">import</span> ColorTable, Themes
</span></span><span style="display:flex;"><span>table <span style="color:#f92672">=</span> ColorTable(theme<span style="color:#f92672">=</span>Themes<span style="color:#f92672">.</span>OCEAN)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># We specify field names for the table and left align the command column</span>
</span></span><span style="display:flex;"><span>table<span style="color:#f92672">.</span>field_names <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;Time&#34;</span>, <span style="color:#e6db74">&#34;User&#34;</span>, <span style="color:#e6db74">&#34;Command&#34;</span>]
</span></span><span style="display:flex;"><span>table<span style="color:#f92672">.</span>align[<span style="color:#e6db74">&#34;Command&#34;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;l&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Information about how to use prettytable can be found on the PyPI page : https://pypi.org/project/prettytable/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (len(argv) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">2</span>):
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;Incorrect number of arguments passed&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;Usage: &#34;</span> <span style="color:#f92672">+</span> argv[<span style="color:#ae81ff">0</span>] <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; &lt;logfile&gt;&#34;</span>)
</span></span><span style="display:flex;"><span>    exit()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>exists(argv[<span style="color:#ae81ff">1</span>]):
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;File doesn&#39;t exist&#34;</span>)
</span></span><span style="display:flex;"><span>    exit()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>filename <span style="color:#f92672">=</span> argv[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>matchpattern<span style="color:#f92672">=</span><span style="color:#e6db74">r</span><span style="color:#e6db74">&#39;(^[a-zA-Z]+ [0-9]+ [0-9:]+)[^:]+:[ ]+([a-zA-Z0-9]+).*COMMAND=(.*)&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(filename, <span style="color:#e6db74">&#34;r&#34;</span>) <span style="color:#66d9ef">as</span> infile:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> line <span style="color:#f92672">in</span> infile<span style="color:#f92672">.</span>readlines():
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> line<span style="color:#f92672">.</span>find(<span style="color:#e6db74">&#34;COMMAND&#34;</span>) <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>            m <span style="color:#f92672">=</span> re<span style="color:#f92672">.</span><span style="color:#66d9ef">match</span>(matchpattern, line)
</span></span><span style="display:flex;"><span>            date <span style="color:#f92672">=</span> m<span style="color:#f92672">.</span>group(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>            name <span style="color:#f92672">=</span> m<span style="color:#f92672">.</span>group(<span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>            command <span style="color:#f92672">=</span> m<span style="color:#f92672">.</span>group(<span style="color:#ae81ff">3</span>)
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Add the data as a row to the table</span>
</span></span><span style="display:flex;"><span>            table<span style="color:#f92672">.</span>add_row([date, name, command[:<span style="color:#ae81ff">30</span>]])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Print the constructed table on the terminal</span>
</span></span><span style="display:flex;"><span>print(table)
</span></span></code></pre></div><p>Now the output shows the information in a pretty table:</p>
<pre tabindex="0"><code>+-----------------+---------+--------------------------------+
|       Time      |   User  | Command                        |
+-----------------+---------+--------------------------------+
| Aug 03 13:56:41 | xyzuser | /usr/bin/apt-get update        |
| Aug 03 13:56:47 | xyzuser | /usr/bin/apt-get upgrade       |
| Aug 03 13:57:02 | xyzuser | /usr/bin/apt-get upgrade -f    |
| Aug 03 13:57:30 | xyzuser | /usr/bin/apt-get dist-upgrade  |
| Aug 03 14:03:02 | xyzuser | /usr/bin/apt-get install gawk  |
| Aug 03 14:05:05 | xyzuser | /usr/bin/do-release-upgrade    |
| Aug 03 14:07:29 | xyzuser | /sbin/reboot now               |
+-----------------+---------+--------------------------------+
</code></pre><ul>
<li><a href="https://docs.python.org">Python documentations</a> for documentation on inbuilt libraries</li>
<li><a href="https://pypi.org">Python Package Index</a> for searching for libraries</li>
<li><a href="https://docs.python.org/3/howto/regex.html">How to use regular expressions in Python</a></li>
<li><a href="https://pypi.org/project/prettytable/">PrettyTable package</a></li>
</ul>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">Abdun Nihaal</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        24-10-2024
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/python/">python</a>
          </div>
      <nav class="post-nav">
        
        <a class="next" href="/post/sed/">
            <span class="next-text nav-default">Notes on Sed</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
  <div id="fd-form-66f8239b39c4e02019d4d467"></div>
  <script>
      window.fd('form', {
          formId: '66f8239b39c4e02019d4d467',
          containerEl: '#fd-form-66f8239b39c4e02019d4d467'
      });
  </script>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://www.twitter.com/nihaal_an" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://in.linkedin.com/in/abdun-nihaal-289272143" class="iconfont icon-linkedin" title="linkedin"></a>
      <a href="https://www.github.com/nifey" class="iconfont icon-github" title="github"></a>
      <a href="https://www.gitlab.com/nihaal" class="iconfont icon-gitlab" title="gitlab"></a>
  
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2016 - 
    2024<span class="heart"><i class="iconfont icon-heart"></i></span><span>Abdun Nihaal</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  <script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
  <script type="text/javascript" src="/lib/fancybox/jquery.fancybox-3.1.20.min.js"></script>



<script type="text/javascript" src="/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
